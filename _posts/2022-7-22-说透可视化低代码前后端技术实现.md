---
layout:     post
title:      说透可视化低代码前后端技术实现
subtitle:   
date:       2022-7-22
author:     BY
header-img: img/post-bg-universe.jpg
catalog: true
tags:
    - 低代码
---


## 前言
最近研发了低代码产品，有一些技术上的心得。也看了网络上的很多文章，并没有发现把核心技术和坑说透的。博客的目的希望能将前后端低代码主要的核心技术分享给大家。文章不对低代码进行入门介绍，也许您需要有一些了解和实操后才能看懂该文章，它会为您解答很多您当前遇到的问题。有任何的建议可以直接留言。如果大家很有需求的话，在有时间的情况下我会考虑提供简单的代码实现，或者实现一款开源的低代码引擎。

## 前端篇

要求通过可视化的拖拽编辑，构建整个前端应用页面。核心是设计器的实现。

设计器的实现从页面上讲主要有四个部分：物料区、编辑区、属性编辑区、其他区域。

第一步：我们需要用JSON描述整个应用：路由区、页面区、页面组件树区、变量区、api区等...。以上不是全部。这部分得设计目前并没有最佳的标准，阿里出了一个标准可以参考，但是阿里的渲染引擎是react实现的，在json定义上有很多react的影子。我们的技术栈的vue,我们自由设计了JSON更符合vue的组件渲染概念。  您不需要也没有能力一开始就能完全定义json的结构，根据您的渲染代码循循渐进的调整json的结构。

第二步：编写渲染JSON到页面的代码。一个页面由组件树组成；一个组件由组件名、属性、事件、子组件组成。使用Vue render函数将json 组件渲染成vue组件。技术关键点：使用eval函数或手动代码将字符串解析成js对象或函数。处理vue stot和scope Slot。

第三步：编辑区编辑效果和拖拽等实现。在编辑区渲染的组件要求有一些编辑效果。钉钉的宜搭的编辑区效果展示是比较不错的。同样我们也能完成相同的效果，想明白后技术上是没有难度的。下面是一个简单的对比，简易demo并没有实现所有细节。
1. 钉钉宜搭效果
![](/img/钉钉易搭.gif)
2. 我的简易demo效果
![](/img/demo.gif)
* 实现原理：很多博客和视频都讲解过一种实现就是在组件外包括一层实现编辑效果的div。但是这种实现方式是不可行的，会产生很多问题。它对原dom产生了侵入，包括布局侵入和样式侵入。在侵入的情况维护编辑区和预览区显示完全一致的会付出比较多的代价。比如ul组件和li组件将li组件拖入ul组件内部，当li组件外包裹了一层div后是无法正常显示的，但是预览时去除后就有可以正常显示。这种实现方式也是无法达到钉钉宜搭的效果的。
* 我推荐的实现方式是：使用绝对定位的方式将实现编辑效果的组件定位到当前的位置。具体实现：在编辑区根dom或直接在body上监听鼠标事件：如监听mousemove实现hover展示效果，为了精准识别组件树中组件的根dom你需要在渲染json时为其添加一个自定义的属性并从中获取组件id如下图。当e.target具备您添加的标识时获取当前dom的位置和宽高将实现编辑效果的dom移动到相同位置，您可以通过组件id获取当前组件的详细信息（在json渲染id->info的缓存）加载不同的编辑效果如文字提示不一样。
* 一旦采用绝对定位的方式实现后，我们需要重新考虑拖拽效果的实现。没有了每个组件最外层的包裹，我们就没有地方未每个组件添加drag事件了。我推荐的方式是：同样通过在编辑区根dom或body上利用鼠标事件来实现拖拽，这种鼠标实现拖拽的方式的浏览器兼容性也是非常好的，你需要使用mourseon、moursemove、moureup这三个事件，这方面的文章很多不做详细描述。
* 带来的好处：不侵入组件dom，编辑效果定制自由化程度非常高，几乎是完美的解决方案。使用这种方式我们可以甚至可以将组件渲染放入一个iframe，然后监听iframe的dom事件，这在技术上也是没有难度的。在ifream中渲染的好处不言而喻，这是非常好的隔离环境防止与物料区和属性区其他页面产生各种冲突。因为应用设计好后它本身应该在一个独立的环境运行。
![](/img/2022-07-22-20-17-26.png)

### 未完待续。。。

# 结语

最后，[给个 star 吧](https://github.com/heykb/heykb.github.io)~